#!/bin/bash

# gitp - Git push with automatic upstream and PR prompt

if [[ "$1" == "--help" || "$1" == "-h" ]]; then
    cat <<'EOF'
gitp - Push current branch and prompt to open a pull request

USAGE:
    gitp [--help|-h]

DESCRIPTION:
    Pushes the current branch to origin with --set-upstream if needed,
    then prompts to open a pull request in your browser.

FEATURES:
    • Automatic upstream setup for new branches
    • Interactive prompt to open a PR (uses GitHub CLI if available)
    • Beautiful, minimal feedback

REQUIREMENTS:
    • git
    • GitHub CLI (gh) for best experience (optional)

EXAMPLES:
    gitp           # Push and prompt for PR
    gitp --help    # Show this help

EOF
    exit 0
fi

git push --set-upstream origin "$(git branch --show-current)"

echo ""
read -p "Open a pull request? (y/n): " open_pr

if [ "$open_pr" = "y" ] || [ "$open_pr" = "Y" ]; then
    # Open PR in browser using GitHub CLI if available, otherwise show URL
    if command -v gh &> /dev/null; then
        gh pr create --web
    else
        repo_url=$(git remote get-url origin | sed 's/\.git$//' | sed 's/git@github\.com:/https:\/\/github\.com\//')
        branch_name=$(git branch --show-current)
        echo "Open PR at: ${repo_url}/compare/${branch_name}?expand=1"
    fi
fi
