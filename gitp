#!/bin/bash

# gitp - Git push with automatic upstream and PR prompt

if [[ "$1" == "-h" || "$1" == "--help" ]]; then
    if [[ -f "$(dirname "$0")/gitp.help" ]]; then
        echo -e "$(cat "$(dirname "$0")/gitp.help")"
    else
        echo "Help file not found"
    fi
    exit 0
fi

git push --set-upstream origin "$(git branch --show-current)"

echo ""
read -p "Open a pull request? (y/n): " open_pr

if [ "$open_pr" = "y" ] || [ "$open_pr" = "Y" ]; then
    # Open PR in browser using GitHub CLI if available, otherwise show URL
    if command -v gh &> /dev/null; then
        gh pr create --web
    else
        repo_url=$(git remote get-url origin | sed 's/\.git$//' | sed 's/git@github\.com:/https:\/\/github\.com\//')
        branch_name=$(git branch --show-current)
        echo "Open PR at: ${repo_url}/compare/${branch_name}?expand=1"
    fi
fi
