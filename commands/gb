#!/bin/bash

# Git branch creator with type selection
# Creates new branch with conventional naming: type/user/name or type/user/uuid

# Load config utilities
source "$(dirname "$(dirname "$0")")/scripts/config-utils.sh"

# Get username from config
username=$(get_username)

if [[ "$1" == "-h" || "$1" == "--help" ]]; then
    if [[ -f "$(dirname "$(dirname "$0")")/help/gb.help" ]]; then
        echo -e "$(cat "$(dirname "$(dirname "$0")")/help/gb.help")"
    else
        echo "Help file not found"
    fi
    exit 0
fi

echo "Branch type:"
echo "1) fix"
echo "2) feat"
echo "3) nit"
read -p "Select (1-3): " choice

case $choice in
    1) type="fix" ;;
    2) type="feat" ;;
    3) type="nit" ;;
    *) echo "Invalid choice"; exit 1 ;;
esac

read -p "Branch name (leave empty for random): " name

if [ -z "$name" ]; then
    # Generate random UUID-like string (8 chars)
    name=$(openssl rand -hex 4)
else
    # Replace spaces with hyphens
    name=$(echo "$name" | tr ' ' '-')
fi

branch_name="${username}/${type}/${name}"
git checkout -b "$branch_name"
echo "Created and switched to branch: $branch_name"
